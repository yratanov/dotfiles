HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt SHARE_HISTORY

ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#878ede"

# --- SSH Bastions ---
alias ssh="TERM=xterm-256color ssh"
bastion() {
  local key="${3:-~/.ssh/aws_id_ed25519}"
  TERM=xterm-256color ssh -i "$key" "$1@bastion$2.satchel.cloud"
}

alias qa="bastion pulse-rw qa"
alias prod="bastion pulse-rw prod"
alias ukprod="bastion pulse-uk-rw prod"
alias ukqa="bastion pulse-uk-rw qa"
alias thrqa="bastion satchel-thrive-rw qa ~/.ssh/id_rsa"
alias caprod="bastion pulse-ca-rw prod"
alias caqa="bastion pulse-ca-rw qa"
alias ccqa="bastion career-clutch-rw qa"
alias ccprod="bastion career-clutch-rw prod"

# --- Ember ---
alias es="ember s --proxy=http://localhost:3000"
alias exam="ember exam --split=10 --parallel > log/test.log"

# --- Rails ---
alias rc="rails console"
alias rdm="rake db:migrate"
alias rdr="rake db:rollback"
alias rgm="rails g migration"
alias test-db-reset="rake db:drop RAILS_ENV=test && rake db:create RAILS_ENV=test && rake db:structure:load RAILS_ENV=test"
alias src="spring rails c"
alias bi="bundle install"
alias bsq="bundle exec sidekiq -C config/sidekiq.yml"
alias ber="bundle exec rspec"
alias psp="COVERAGE=true bundle exec rake parallel:spec"

# --- Docker ---
alias dcw="docker compose exec web"
alias dcd="docker compose down"
alias dcu="docker compose up -d"

# --- Git ---
alias git-rev="git restore --source=HEAD^ --staged --worktree"
alias gcnv="git commit --no-verify"
alias lg="lazygit"
alias gpr="gh pr create -f -r drosam,pikislabis,Nerian"

# --- Tools ---
alias mux="tmuxinator"
alias nv="nvim"
alias merge_qa="~/.config/nvim/scripts/git_merge_current_to_qa.sh"
alias tt="~/.bin/new-tmux-session.sh"
alias nb="~/.bin/feature-branch.sh"
alias taskwarrior="command tw --theme catppuccin"

if [[ "$(uname)" == "Linux" ]]; then
  alias ll="ls -lAhF --color=auto --group-directories-first"
  alias open='xdg-open'
  alias SatchelVPN="~/.bin/toggle_service.sh openvpn-client@satchelcloud"

  # Pacman/yay aliases
  alias pas="sudo pacman -S"
  alias pad="sudo pacman -R"
  alias yas="yay -S"
  alias yad="yay -R"
  alias rofi-refresh='update-desktop-database ~/.local/share/applications && rm -f ~/.cache/rofi-drun-desktop.cache'

  source <(fzf --zsh)
  source /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh

  export PATH="$HOME/.bin:$PATH:/var/lib/snapd/snap/bin"
else
  alias ll="ls -lAhG"

  export PATH="/opt/homebrew/opt/postgresql@12/bin:$HOME/.bin:/opt/homebrew/opt/openjdk/bin:$PATH"
  export LDFLAGS="-L/opt/homebrew/opt/postgresql@12/lib"
  export PKG_CONFIG_PATH="/opt/homebrew/opt/postgresql@12/lib/pkgconfig"
  export CPPFLAGS="-I/opt/homebrew/opt/postgresql@12/include"

  [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
  source /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
fi

export EDITOR='nvim'
alias dfl='/usr/bin/git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME'

eval "$(starship init zsh)"
eval "$(mise activate zsh)"

bindkey '^A' beginning-of-line
bindkey '^E' end-of-line

autoload -Uz compinit
compinit
source ~/.config/zsh/gh
export PATH="$HOME/.local/bin:$PATH"
